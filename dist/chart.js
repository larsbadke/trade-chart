function buildChart(t,e,a){margin={top:5,bottom:30,left:5,right:50},y=d3.scaleLinear().domain([minYValue(t),maxYValue(t)]).range([a-margin.bottom,margin.top]),x=d3.scaleTime().domain([new Date(t[0].Date),new Date(2016,1,31)]).range([0,e]),layer1.selectAll("line.y").data(y.ticks(10)).enter().append("svg:line").attr("class","y").attr("x1",margin.left).attr("x2",e-margin.right).attr("y1",y).attr("y2",y).attr("stroke","#ccc"),layer1.selectAll("line.x").data(x.ticks(d3.timeMonth)).enter().append("svg:line").attr("class","x").attr("x1",x).attr("x2",x).attr("y1",margin.top).attr("y2",a-margin.bottom).attr("stroke","#ccc");var r=(d3.axisBottom().scale(x).ticks(d3.timeMonth).tickSize(16,0).tickFormat(d3.timeFormat("%b")),["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]);layer2.selectAll("text.xrule").data(x.ticks(d3.timeMonth)).enter().append("svg:text").attr("class","xrule").attr("x",x).attr("y",a-margin.bottom).attr("dy",20).attr("text-anchor","middle").text(function(t){return 0==t.getMonth()?r[t.getMonth()]+" "+t.getFullYear():r[t.getMonth()]}),layer2.selectAll("text.yrule").data(y.ticks(10)).enter().append("svg:text").attr("class","yrule").attr("x",e-margin.right+10).attr("y",y).attr("dy",0).attr("dx",20).attr("text-anchor","middle").text(String),layer2.selectAll("rect").data(t).enter().append("svg:rect").attr("x",function(t){return x(Date.parse(t.Date))}).attr("y",function(t){return y(max(t.Open,t.Close))}).attr("height",function(t){return y(min(t.Open,t.Close))-y(max(t.Open,t.Close))}).attr("width",function(a){return.5*(e-2*margin.right)/t.length}).attr("fill",function(t){return t.Open>t.Close?"red":"green"}),layer2.selectAll("line.stem").data(t).enter().append("svg:line").attr("class","stem").attr("x1",function(a){return x(Date.parse(a.Date))+.25*(e-2*margin.right)/t.length}).attr("x2",function(a){return x(Date.parse(a.Date))+.25*(e-2*margin.right)/t.length}).attr("y1",function(t){return y(t.High)}).attr("y2",function(t){return y(t.Low)}).attr("stroke",function(t){return t.Open>t.Close?"red":"green"})}function maxXValue(t){var e=d3.max(t.map(function(t){return Date.parse(t.Date)})),a=[e,Date.parse(trade.StopLoss.End),Date.parse(trade.TakeProfit.End)];return Math.max.apply(Math,a)}function minXValue(t){var e=d3.min(t.map(function(t){return Date.parse(t.Date)})),a=[e,Date.parse(trade.StopLoss.Start),Date.parse(trade.TakeProfit.Start)];return Math.min.apply(Math,a)}function maxYValue(t){var e=d3.max(t.map(function(t){return t.High})),a=[e,trade.TakeProfit.Value,trade.StopLoss.Value];return 1.01*Math.max.apply(Math,a)}function minYValue(t){var e=d3.min(t.map(function(t){return t.Low})),a=[e,trade.TakeProfit.Value,trade.StopLoss.Value];return.99*Math.min.apply(Math,a)}function drawStopLoss(t,e,a){var r=x(Date.parse(t)),n=x(Date.parse(e)),i=y(a),o=new Line(r,n,i,i);o.setColor("red"),o.setStyle("stroke-dasharray","3, 3"),o.draw()}function drawTakeProfit(t,e,a){var r=x(Date.parse(t)),n=x(Date.parse(e)),i=y(a),o=new Line(r,n,i,i);o.setColor("green"),o.setStyle("stroke-dasharray","3, 3"),o.draw()}function drawHeader(t){layer3.append("text").attr("x",5).attr("y",20).text(t).attr("font-family","sans-serif").attr("font-size","14px").attr("fill","black")}function getFormattedDate(t){return"de"==options.dateFormat?t.getDate()+"."+(t.getMonth()+1):t.getMonth()+1+"/"+t.getDate()}function min(t,e){return t<e?t:e}function max(t,e){return t>e?t:e}function Chart(t,e,a){function r(t){for(var e=0;e<t.length;e++)t[e].timestamp=new Date(t[e].Date).getTime()/1e3;return t.sort(function(t,e){return Date.parse(t.Date)-Date.parse(e.Date)})}chart=d3.select(t).append("svg:svg").attr("class","chart").attr("width",e).attr("height",a),layer1=chart.append("g"),layer2=chart.append("g"),layer3=chart.append("g"),this.setData=function(t){buildChart(r(t),e,a)},this.stoploss=function(t,e,a){drawStopLoss(t,e,a)},this.takeprofit=function(t,e,a){drawTakeProfit(t,e,a)},this.drawHeader=function(t){drawHeader(t)}}function Line(t,e,a,r){var n={x1:t,x2:e,y1:a,y2:r,color:"black",width:"1",style:null,setColor:function(t){this.color=t},setWidth:function(t){this.width=t},setStyle:function(t,e){this.style=[t,e]},draw:function(){return chart.append("line").attr("x1",this.x1).attr("x2",this.x2).attr("y1",this.y1).attr("y2",this.y2).attr("stroke",this.color).attr("width",this.width).style(this.style[0],this.style[1])}};return n}