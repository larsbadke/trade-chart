function Chart(t,a,e){var r={data:null,width:a,height:e,margin:{top:5,bottom:30,left:5,right:80},chart:d3.select(t).append("svg:svg").attr("class","chart").attr("width",a).attr("height",e),setData:function(t){this.data=this.parseData(t)},getData:function(){return this.data},layer:function(){return this.chart.append("g")},scale:function(){return y=d3.scaleLinear().domain([minYValue(this.data),maxYValue(this.data)]).range([this.height-this.margin.bottom,this.margin.top]),x=d3.scaleTime().domain([new Date(this.data[0].Date),new Date(2015,8,10)]).range([0,this.width-this.margin.right]),{x:x,y:y}},grid:function(t){var a=this;t.selectAll("line.y").data(y.ticks(10)).enter().append("svg:line").attr("class","y").attr("x1",a.margin.left).attr("x2",a.width-a.margin.right).attr("y1",y).attr("y2",y).attr("stroke","#ccc"),t.selectAll("line.x").data(x.ticks(d3.timeMonth)).enter().append("svg:line").attr("class","x").attr("x1",x).attr("x2",x).attr("y1",a.margin.top).attr("y2",a.height-a.margin.bottom).attr("stroke","#ccc")},axis:function(t){var a=this,e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];t.selectAll("text.xrule").data(x.ticks(d3.timeMonth)).enter().append("svg:text").attr("class","xrule").attr("x",x).attr("y",a.height-a.margin.bottom).attr("dy",20).attr("text-anchor","middle").text(function(t){return 0==t.getMonth()?e[t.getMonth()]+" "+t.getFullYear():e[t.getMonth()]}),t.selectAll("text.yrule").data(y.ticks(10)).enter().append("svg:text").attr("class","yrule").attr("x",a.width-a.margin.right+10).attr("y",y).attr("dy",0).attr("dx",20).attr("text-anchor","middle").text(function(t){return d3.format("$,.2f")(t)})},candle:function(t){var a=this;t.selectAll("rect").data(a.data).enter().append("svg:rect").attr("x",function(t){return x(Date.parse(t.Date))}).attr("y",function(t){return y(max(t.Open,t.Close))}).attr("height",function(t){return y(min(t.Open,t.Close))-y(max(t.Open,t.Close))}).attr("width",function(t){return.5*(a.width-2*a.margin.right)/a.data.length}).attr("fill",function(t){return t.Open>t.Close?"red":"green"}),t.selectAll("line.stem").data(a.data).enter().append("svg:line").attr("class","stem").attr("x1",function(t){return x(Date.parse(t.Date))+.25*(a.width-2*a.margin.right)/a.data.length}).attr("x2",function(t){return x(Date.parse(t.Date))+.25*(a.width-2*a.margin.right)/a.data.length}).attr("y1",function(t){return y(t.High)}).attr("y2",function(t){return y(t.Low)}).attr("stroke",function(t){return t.Open>t.Close?"red":"green"})},build:function(){layer1=this.layer(),layer2=this.layer();var t=this.scale();t.x,t.y;this.grid(layer1),this.axis(layer2),this.candle(layer2)},header:function(t){this.layer().append("text").attr("x",5).attr("y",20).attr("font-family","sans-serif").attr("font-weight",600).attr("font-size","14px").attr("fill","black").text(t)},parseData:function(t){for(var a=0;a<t.length;a++)t[a].timestamp=new Date(t[a].Date).getTime()/1e3;return t.sort(function(t,a){return Date.parse(t.Date)-Date.parse(a.Date)})}};return r}function maxXValue(t){var a=d3.max(t.map(function(t){return Date.parse(t.Date)})),e=[a,Date.parse(Stock.StopLoss.End),Date.parse(Stock.TakeProfit.End)];return Math.max.apply(Math,e)}function minXValue(t){var a=d3.min(t.map(function(t){return Date.parse(t.Date)})),e=[a,Date.parse(Stock.StopLoss.Start),Date.parse(Stock.TakeProfit.Start)];return Math.min.apply(Math,e)}function maxYValue(t){var a=d3.max(t.map(function(t){return t.High})),e=[a,Stock.TakeProfit.Price,Stock.StopLoss.Price];return 1.01*Math.max.apply(Math,e)}function minYValue(t){var a=d3.min(t.map(function(t){return t.Low})),e=[a,Stock.TakeProfit.Price,Stock.StopLoss.Price];return.99*Math.min.apply(Math,e)}function Trade(t){var a={chart:t,layer:t.layer(),stoploss:function(t){var a=x(Date.parse(t.Start)),e=x(Date.parse(t.End)),r=y(t.Price),n=new Line(this.layer,a,e,r,r);n.setColor("red"),n.setWidth(2),n.setStyle("stroke-dasharray","5, 5"),n.draw()},takeprofit:function(t){var a=x(Date.parse(t.Start)),e=x(Date.parse(t.End)),r=y(t.Price),t=new Line(this.layer,a,e,r,r);t.setColor("green"),t.setWidth(2),t.setStyle("stroke-dasharray","5, 5"),t.draw()},entry:function(t){var a;this.chart.getData().forEach(function(e,r){t.Date==e.Date&&(a=e.Low)});var e="#11490a",r=60,n=d3.symbol().type(d3.symbolTriangle).size(r),i=[{x:Date.parse(t.Date),y:a}];this.layer.selectAll(".point").data(i).enter().append("path").attr("d",n).attr("fill",e).attr("stroke",e).attr("transform",function(t){return"translate("+(x(t.x)+2.5)+","+(y(t.y)+Math.sqrt(r))+")"})},exit:function(t){var a;this.chart.getData().forEach(function(e,r){t.Date==e.Date&&(a=e.High)});var e="red",r=60,n=d3.symbol().type(d3.symbolTriangle).size(r),i=[{x:Date.parse(t.Date),y:a}];this.layer.selectAll(".point").data(i).enter().append("path").attr("d",n).attr("fill",e).attr("stroke",e).attr("transform",function(t){return"translate("+(x(t.x)+2.5)+","+(y(t.y)-Math.sqrt(r))+") rotate(180)"})}};return a}function getFormattedDate(t){return"de"==options.dateFormat?t.getDate()+"."+(t.getMonth()+1):t.getMonth()+1+"/"+t.getDate()}function min(t,a){return t<a?t:a}function max(t,a){return t>a?t:a}function Line(t,a,e,r,n){var i={x1:a,x2:e,y1:r,y2:n,color:"black",width:1,style:null,setColor:function(t){this.color=t},setWidth:function(t){this.width=t},setStyle:function(t,a){this.style=[t,a]},draw:function(){return t.append("line").attr("x1",this.x1).attr("x2",this.x2).attr("y1",this.y1).attr("y2",this.y2).attr("stroke",this.color).attr("stroke-width",this.width).style(this.style[0],this.style[1])}};return i}