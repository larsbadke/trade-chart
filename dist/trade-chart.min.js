"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function getFormattedDate(t){return"de"==options.dateFormat?t.getDate()+"."+(t.getMonth()+1):t.getMonth()+1+"/"+t.getDate()}function min(t,e){return t<e?t:e}function max(t,e){return t>e?t:e}function isFirstTradingDayofMonth(t,e){if(t){var a=new Date(e[t].Date),n=new Date(e[t-1].Date);return n.getMonth()!=a.getMonth()}return!1}function daysBetween(t,e){var a=864e5,n=t.getTime(),r=e.getTime(),i=r-n;return Math.ceil(i/a)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),e}}(),Chart=function(){function t(e,a,n){_classCallCheck(this,t),this.element=e,this.data=a,this.locale=n.hasOwnProperty("locale")?n.locale:"en_US",this.currency=n.hasOwnProperty("currency")?n.currency:"usd",this.width=n.hasOwnProperty("width")?n.width:1e3,this.height=n.hasOwnProperty("height")?n.height:700,this.type=n.hasOwnProperty("type")?n.type.toLowerCase():"line",this.x=null,this.y=null,this.xAxis=null,this.yAxis=null,this.layers=[],this.margin={top:30,bottom:30,left:10,right:50},this.scale(),this.chart=d3.select(this.element).append("svg:svg").attr("width",this.width).attr("height",this.height).attr("transform","translate(0, 0)")}return _createClass(t,[{key:"Data",value:function(){return this.data}},{key:"getLayers",value:function(){return this.layers}},{key:"newLayer",value:function(){var t=this.chart.append("g");return this.layers.push(t),t}},{key:"scale",value:function e(){var e=new Scale(this.data.all(),this.width,this.height,this.margin);this.y=e.y(),this.x=e.x()}},{key:"redraw",value:function(){var t=this;this.x.domain(this.data.map(function(t){return Date.parse(t.Date)})),this.y.domain([d3.min(this.data,function(t){return t.Low}),d3.max(this.data,function(t){return t.High})]).nice();var e=d3.select(element);e.select(".xAxis").call(this.xAxis),e.select(".yAxis").call(this.yAxis);var a=this.chart.selectAll(".candles"),n=this.chart.selectAll(".stem");a.remove(),n.remove(),this.chart.selectAll("rect").data(this.data.filter(function(t){if("undefined"!=typeof t.Close)return t})).enter().append("svg:rect").attr("class","candles").attr("x",function(e){return t.x(Date.parse(e.Date))-.25*(t.width-t.margin.right)/t.data.length}).attr("y",function(e){return t.y(max(e.Open,e.Close))}).attr("height",function(e){return t.y(min(e.Open,e.Close))-t.y(max(e.Open,e.Close))}).attr("width",function(e){return.5*(t.width-t.margin.right)/t.data.length}).attr("fill",function(t){return t.Open>t.Close?"red":"green"}),this.chart.selectAll("line.stem").data(this.data.filter(function(t){if("undefined"!=typeof t.Close)return t})).enter().append("svg:line").attr("class","stem").attr("x1",function(e){return t.x(Date.parse(e.Date))}).attr("x2",function(e){return t.x(Date.parse(e.Date))}).attr("y1",function(e){return t.y(e.High)}).attr("y2",function(e){return t.y(e.Low)}).attr("stroke",function(t){return t.Open>t.Close?"red":"green"})}},{key:"draw",value:function(){var t=this.newLayer(),e=this.newLayer();this.drawAxis(t),this.drawChart(e)}},{key:"drawAxis",value:function(t){var e=new Axis(this.data,this.width,this.height,this.margin);this.xAxis=e.x(this.x,this.locale),this.yAxis=e.y(this.y,this.locale,this.currency),t.append("g").attr("class","Axis").attr("width",this.width-this.margin.right).attr("height",this.height).call(this.xAxis).attr("transform","translate(0,"+(this.height-this.margin.bottom)+")"),t.append("g").attr("class","Axis").attr("height",this.height).call(this.yAxis).attr("transform","translate("+[this.width-this.margin.right,0]+" )"),t.append("line").attr("class","xAxis").attr("x1",this.margin.left).attr("y1",this.margin.bottom).attr("x2",this.margin.left).attr("y2",this.height-this.margin.bottom).attr("fill","black").attr("stroke","black")}},{key:"drawChart",value:function(t){var e=new ChartType(this.type),a=this.width;e.draw(this.chart,this.data,this.x,this.y,a,this.height,this.margin)}},{key:"header",value:function(t){var e=this;this.chart.append("text").attr("x",0+e.margin.left).attr("y",20).attr("font-family","sans-serif").attr("font-weight",400).attr("font-size","16px").attr("fill","black").text(t)}}]),t}(),_createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),e}}(),Redraw=function(){function t(e,a){_classCallCheck(this,t),this.x=e,this.y=a}return _createClass(t,[{key:"toString",value:function(){return"("+this.x+", "+this.y+")"}}]),t}(),_createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),e}}(),Trade=function(){function t(e){_classCallCheck(this,t),this.chart=e,this.layers=e.getLayers()}return _createClass(t,[{key:"stoploss",value:function(t){this.findDay(t.End,this.chart.Data().all())||this.chart.Data().spaceUntil(t.End);var e=this.chart.x(Date.parse(t.Start)),a=this.chart.x(Date.parse(t.End)),n=this.chart.y(t.Price),t=new Line(this.layers[1],e,a,n,n);t.setColor("red"),t.setWidth(2),t.setStyle("stroke-dasharray","5, 5"),t.draw()}},{key:"takeprofit",value:function(t){var e=this.chart.x(Date.parse(t.Start)),a=this.chart.x(Date.parse(t.End)),n=this.chart.y(t.Price),t=new Line(this.layers[1],e,a,n,n);t.setColor("green"),t.setWidth(2),t.setStyle("stroke-dasharray","5, 5"),t.draw()}},{key:"createTriangle",value:function(t){return d3.symbol().type(d3.symbolTriangle).size(t)}},{key:"findDay",value:function(t,e){var a=!1;return e.forEach(function(e,n){if(t==e.Date)return a=e}),!!a&&a}},{key:"entry",value:function(t){var e=this.chart,a=this.findDay(t.Date,this.chart.Data().candles());if(!a)throw"Date is not found";var n="#11490a",r=70,i=this.createTriangle(r),s=[{x:Date.parse(t.Date),y:a.Low}];this.layers[1].selectAll(".point").data(s).enter().append("path").attr("d",i).attr("fill",n).attr("stroke",n).attr("transform",function(t){return"translate("+e.x(t.x)+","+(e.y(t.y)+Math.sqrt(r+15))+")"})}},{key:"exit",value:function(t){var e=this.chart,a=this.findDay(t.Date,this.chart.Data().candles());if(!a)throw"Date is not found";var n="red",r=70,i=this.createTriangle(r),s=[{x:Date.parse(t.Date),y:a.High}];this.layers[1].selectAll(".point").data(s).enter().append("path").attr("d",i).attr("fill",n).attr("stroke",n).attr("transform",function(t){return"translate("+e.x(t.x)+","+(e.y(t.y)-Math.sqrt(r+15))+") rotate(180)"})}}]),t}(),de_DE=d3.formatLocale({decimal:",",thousands:".",grouping:[3],currency:["","€"],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}),_createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),e}}(),CandlestickChart=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"draw",value:function(t,e,a,n,r,i,s){t.selectAll("rect").data(e.candles()).enter().append("svg:rect").attr("class","candles").attr("x",function(t){return a(Date.parse(t.Date))-.25*(r-s.right)/e.count()}).attr("y",function(t){var e=parseFloat(t.Open).toFixed(3),a=parseFloat(t.Close).toFixed(3);return n(max(e,a))}).attr("height",function(t){var e=parseFloat(t.Open).toFixed(3),a=parseFloat(t.Close).toFixed(3);return e==a&&(e-=.005),n(Math.min(e,a))-n(Math.max(e,a))}).attr("width",function(t){return.5*(r-s.right)/e.count()}).attr("fill",function(t){return t.Open>t.Close?"red":"green"}),t.selectAll("line.stem").data(e.candles()).enter().append("svg:line").attr("class","stem").attr("x1",function(t){return a(Date.parse(t.Date))}).attr("x2",function(t){return a(Date.parse(t.Date))}).attr("y1",function(t){return n(t.High)}).attr("y2",function(t){return n(t.Low)}).attr("stroke",function(t){return t.Open>t.Close?"red":"green"})}}]),t}(),ChartType=function t(e){switch(_classCallCheck(this,t),e){case"candlestick":return new CandlestickChart;case"line":return new LineChart}return null},_createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),e}}(),LineChart=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"draw",value:function(t,e,a,n,r,i,s){var l=d3.line().x(function(t){return a(Date.parse(t.Date))}).y(function(t){return n(t.Close)});t.append("path").datum(e.candles()).attr("class","line").attr("d",l)}}]),t}(),_createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),e}}(),Axis=function(){function t(e,a,n,r){_classCallCheck(this,t),this.data=e,this.width=a,this.height=n,this.margin=r}return _createClass(t,[{key:"y",value:function(t,e,a){var n=d3.format(",.1f");return"de-DE"==e&&(n=de_DE.format(",.1f")),d3.axisRight(t).tickSize(-(this.width-this.margin.right-this.margin.left)).tickFormat(function(t){return"eur"==a?n(t)+"€":"$"+n(t)})}},{key:"x",value:function(t,e){var a=this,n=this.data.all().map(function(t,e){return isFirstTradingDayofMonth(e,a.data.all())?Date.parse(t.Date):null}).filter(function(t){if(null!==typeof t)return t});return d3.axisBottom(t).tickValues(n).tickSize(-(this.height-this.margin.bottom-this.margin.top)).tickSizeOuter(0).tickPadding(10).tickFormat(function(t){var a=new Date(t),n={month:"short"};return 0==a.getMonth()?(n.year="numeric",a.toLocaleDateString(e,n)):a.toLocaleDateString(e,n)})}}]),t}(),_createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),e}}(),Scale=function(){function t(e,a,n,r){_classCallCheck(this,t),this.data=e,this.width=a,this.height=n,this.margin=r}return _createClass(t,[{key:"y",value:function(){var t=d3.min(this.data,function(t){return parseFloat(t.Low)});t=.98*t;var e=d3.max(this.data,function(t){return parseFloat(t.High)});return e=1.02*e,d3.scaleLinear().domain([t,e]).range([this.height-this.margin.bottom,this.margin.top])}},{key:"x",value:function(){return d3.scalePoint().domain(this.data.map(function(t){return Date.parse(t.Date)})).range([this.margin.left,this.width-this.margin.right-this.margin.left]).align(.5)}}]),t}(),_createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),e}}(),ChartData=function(){function t(e){_classCallCheck(this,t),this.data=this.set(e)}return _createClass(t,[{key:"set",value:function(t){return t.sort(function(t,e){return Date.parse(t.Date)-Date.parse(e.Date)})}},{key:"add",value:function(t){this.data=this.data.concat(t)}},{key:"spaceUntil",value:function(t){var e=this.data[this.data.length-1],a=new Date(e.Date),n=new Date(t),r=daysBetween(a,n);this.addSpace(r)}},{key:"addSpace",value:function(t){for(var e=this.data[this.data.length-1],a=new Date(e.Date),n=[],r=0;r<t;r++){a.setDate(a.getDate()+1);var i={},s=("0"+(a.getMonth()+1)).slice(-2),l=("0"+a.getDate()).slice(-2);i.Date=a.getFullYear()+"-"+s+"-"+l,n.push(i)}this.add(n)}},{key:"count",value:function(){return this.all().length}},{key:"candles",value:function(){return this.all().filter(function(t){if("undefined"!=typeof t.Close)return t})}},{key:"all",value:function(){return this.data}}]),t}(),_createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),e}}(),Line=function(){function t(e,a,n,r,i){_classCallCheck(this,t),this.layer=e,this.x1=a,this.x2=n,this.y1=r,this.y2=i,this.color="black",this.width=1,this.style=null}return _createClass(t,[{key:"setColor",value:function(t){this.color=t}},{key:"setWidth",value:function(t){this.width=t}},{key:"setStyle",value:function(t,e){this.style=[t,e]}},{key:"draw",value:function(){return this.layer.append("line").attr("x1",this.x1).attr("x2",this.x2).attr("y1",this.y1).attr("y2",this.y2).attr("stroke",this.color).attr("stroke-width",this.width).style(this.style[0],this.style[1])}}]),t}();